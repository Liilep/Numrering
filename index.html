<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Textnummermodifierare</title>
</head>
<body>
    <h1>Textnummermodifierare</h1>

    <input type="file" id="fileInput" />
    <button onclick="processFile()">Bearbeta fil</button>

    <textarea id="output" rows="20" cols="80" placeholder="Bearbetad text visas här..." readonly></textarea>

    <script>
        function processFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert('Vänligen välj en fil att bearbeta.');
                return;
            }

            const reader = new FileReader();

            reader.onload = function(event) {
                let text = event.target.result;
                text = modifyText(text);
                document.getElementById('output').value = text;
            };

            reader.readAsText(file);
        }

        function modifyText(text) {
            let lines = text.split('\n');
            let currentNumber = 1;  // Starta numreringen från 1
            let sectionNumber = 0;  // För att hålla reda på vilken sektion vi är i
            let lastRowNumber = 4;  // Första sektionen slutar på 4

            for (let i = 0; i < lines.length; i++) {
                // Kontrollera om raden är en SeatAdd och inte en RowAdd
                if (lines[i].includes('SeatAdd') && !lines[i].includes('RowAdd')) {
                    const match = lines[i].match(/Name=(\d+)/);
                    if (match) {
                        let name = parseInt(match[1]);

                        // Första sektionen
                        if (sectionNumber === 0) {
                            if (currentNumber <= 4) {
                                name = currentNumber; // Behåll numreringen 1-4
                            } else if (currentNumber >= 5 && currentNumber <= 8) {
                                name = 29 + (currentNumber - 5); // Raderna 5-8 döps om till 29-32
                            }
                        }
                        // För andra sektionen och vidare
                        else {
                            if (currentNumber <= 4) {
                                name = lastRowNumber + 1; // Första 4 raderna fortsätter från raden efter föregående sektion
                            } else if (currentNumber >= 5 && currentNumber <= 8) {
                                name = lastRowNumber + 4 + (currentNumber - 5); // Raderna 5-8 fortsätter från den föregående sektionen, ex: 33 till 36
                            }
                        }

                        // Ersätt det gamla namnet med det nya
                        lines[i] = lines[i].replace(/Name=\d+/, `Name=${name}`);

                        // Uppdatera det senaste numret
                        lastRowNumber = name;

                        // Öka räknaren för nästa rad
                        currentNumber++;
                    }
                }

                // Kolla på RowAdd för att hålla koll på sektioner
                if (lines[i].includes('RowAdd')) {
                    sectionNumber++;
                    currentNumber = 1; // Nollställ räknaren vid ny sektion
                }
            }

            return lines.join('\n');
        }
    </script>
</body>
</html>
